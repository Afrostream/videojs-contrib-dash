/*! videojs-contrib-dash - v1.1.1 - 2015-10-15
 * Copyright (c) 2015 Brightcove  */
!function(a,b){"use strict";b.BitrateMenuButton=b.MenuButton.extend({init:function(a,c){b.MenuButton.call(this,a,c),this.updateVisibility(),this.updateLabel(),this.on(a,"loadstart",this.updateVisibility),this.on(a,"initialized",this.update),this.on(a,"bitratechange",this.updateVisibility),this.on(a,"bitratechange",this.updateLabel)}}),b.ControlBar.prototype.options_.children.bitrateMenuButton={},b.BitrateMenuButton.Labels=["bas","moyen","normal","HD","auto"],b.BitrateMenuButton.prototype.buttonText="Quality Selection",b.BitrateMenuButton.prototype.className="vjs-bitrate",b.BitrateMenuButton.prototype.createEl=function(){var a=b.MenuButton.prototype.createEl.call(this);return this.labelEl_=b.createEl("div",{className:"vjs-bitrate-value",innerHTML:1}),a.appendChild(this.labelEl_),a},b.BitrateMenuButton.prototype.createMenu=function(){if(this.player().tech){var a=new b.Menu(this.player()),c=this.player().tech.featuresBitrates;if(c){a.addChild(new b.BitrateMenuItem(this.player(),{qualityIndex:c.length,bitrate:"Auto"}));for(var d=c.length-1;d>=0;d--){var e=c[d];a.addChild(new b.BitrateMenuItem(this.player(),e))}}return a}},b.BitrateMenuButton.prototype.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().tech.getBitrate())},b.BitrateMenuButton.prototype.onClick=function(){for(var a=this.player().playbackRate(),b=this.player().tech.featuresBitrateIndex,c=b[0],d=0;d<b.length;d++)if(b[d]>a){c=b[d];break}this.player().playbackRate(c)},b.BitrateMenuButton.prototype.bitratesSupported=function(){return this.player().tech&&this.player().tech.featuresBitrates&&this.player().tech.featuresBitrates.length>0},b.BitrateMenuButton.prototype.updateVisibility=function(){this.bitratesSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},b.BitrateMenuButton.prototype.updateLabel=function(){if(this.bitratesSupported()){var a=this.player().tech.featuresBitrateIndex;this.labelEl_.innerHTML=b.BitrateMenuButton.Labels[a]}},b.BitrateMenuItem=b.MenuItem.extend({contentElType:"button",init:function(a,c){var d=this.label=parseInt(c.bitrate,10)?c.bitrate/1e3:c.bitrate,e=this.qualityIndex=c.qualityIndex;c.label=b.BitrateMenuButton.Labels[e]||d,c.selected=e===a.tech.featuresBitrates.length||1,b.MenuItem.call(this,a,c),this.on(a,"bitratechange",this.update)}}),b.BitrateMenuItem.prototype.onClick=function(){b.MenuItem.prototype.onClick.call(this),this.player().tech.setQuality(this.qualityIndex)},b.BitrateMenuItem.prototype.update=function(){this.selected(this.player().tech.featuresBitrateIndex===this.bitrateIndex)}}(window,window.videojs),function(a,b){"use strict";function c(a,d){var e,f=this.options(b.util.mergeOptions(this.options_,d.options()));this.tech_=d,this.tech_.getPlaybackStatistics=b.bind(this,this.getPlaybackStatistics),this.el_=d.el(),this.elParent_=this.el_.parentNode,a.src&&(d.isReady_=!1,e=a.src,this.keySystemOptions_=c.buildDashJSProtData(a.keySystemOptions),c.hideErrors(this.elParent_),c.useVideoJSDebug&&c.useVideoJSDebug(b),c.context_=c.context_||new Dash.di.DashContext,this.mediaPlayer_=new MediaPlayer(c.context_),this.mediaPlayer_.startup(),this.mediaPlayer_.addEventListener(MediaPlayer.events.STREAM_INITIALIZED,b.bind(this,this.onInitialized)),this.mediaPlayer_.addEventListener(MediaPlayer.events.STREAM_SWITCH_STARTED,b.bind(this,this.onStreamSwitchComplete)),this.mediaPlayer_.addEventListener(MediaPlayer.events.STREAM_SWITCH_COMPLETED,b.bind(this,this.onStreamSwitchComplete)),MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME=f.buffer.minBufferTime,MediaPlayer.dependencies.BufferController.LOW_BUFFER_THRESHOLD=f.buffer.lowBufferThreshold,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY=f.buffer.bufferTimeAtTopQuality,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=f.buffer.bufferTimeAtTopQualityLongForm,MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD=f.buffer.longFormContentDurationThreshold,MediaPlayer.dependencies.BufferController.RICH_BUFFER_THRESHOLD=f.buffer.richBufferThreshold,MediaPlayer.dependencies.BufferController.BUFFER_TO_KEEP=f.buffer.bufferToKeep,MediaPlayer.dependencies.BufferController.BUFFER_PRUNING_INTERVAL=f.buffer.bufferPruningInterval,this.mediaPlayer_.addEventListener(MediaPlayer.events.METRIC_CHANGED,b.bind(this,this.onMetricChanged)),this.mediaPlayer_.attachView(this.el_),f.autoplay||this.mediaPlayer_.setAutoPlay(!1),this.mediaPlayer_.setAutoSwitchQuality(f.autoSwitch),this.mediaPlayer_.retrieveManifest(e,b.bind(this,this.initializeDashJS)))}var d=function(a){return"[object Array]"===Object.prototype.toString.call(a)},e=function(a){return"[object Object]"===Object.prototype.toString.call(a)},f=function(a,b){var c,d,g,h;h={};for(c in b)b.hasOwnProperty(c)&&(d=a[c],g=b[c],e(d)&&e(g)?a[c]=f(d,g):a[c]=b[c]);return a};c.prototype.options_={autoSwitch:!0,buffer:{minBufferTime:12,lowBufferThreshold:4,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:300,longFormContentDurationThreshold:600,richBufferThreshold:20,bufferToKeep:30,bufferPruningInterval:30}},c.prototype.options=function(a){return void 0===a?this.options_:this.options_=b.util.mergeOptions(this.options_,a)},c.prototype.onInitialized=function(a,c){c&&this.player().error(c);var d=this.mediaPlayer_.getBitrateInfoListFor("video");this.tech_.featuresBitrates=d,this.tech_.featuresBitrateIndex=d.length,b.log("Bitrates available:"+d.length),this.tech_.setQuality=b.bind(this,this.setQuality),this.tech_.trigger("initialized"),this.tech_.trigger("bitratechange")},c.prototype.setQuality=function(a){var b=this.mediaPlayer_.getBitrateInfoListFor("video");this.mediaPlayer_.setAutoSwitchQuality(a>=b.length),this.mediaPlayer_.setQualityFor("video",a),this.tech_.featuresBitrateIndex=a,this.tech_.trigger("bitratechange")},c.prototype.getBitrate=function(){return this.mediaPlayer_.getBitrateInfoListFor("video")},c.prototype.getPlaybackStatistics=function(){return{video:this.getCribbedMetricsFor("video"),audio:this.getCribbedMetricsFor("audio")}},c.prototype.getPlaybackAudioData=function(){return this.mediaPlayer_.getBitrateInfoListFor("audio")},c.prototype.getCribbedMetricsFor=function(a){var b,c,d,e,f,g,h,i,j,k=this.mediaPlayer_.getMetricsFor(a),l=this.mediaPlayer_.getMetricsExt(),m=0,n={},o={},p={},q=0,r=function(a,b){var c,d,e,f;c=b.slice(-20).filter(function(b){return b.responsecode>=200&&b.responsecode<300&&!!b.mediaduration&&"Media Segment"===b.type&&b.stream===a}).slice(-4),c.length>0&&(e=c.map(function(a){return Math.abs(a.tresponse.getTime()-a.trequest.getTime())/1e3}),n[a]={average:e.reduce(function(a,b){return a+b})/e.length,high:e.reduce(function(a,b){return b>a?b:a}),low:e.reduce(function(a,b){return b>a?a:b}),count:e.length},d=c.map(function(a){return Math.abs(a.tfinish.getTime()-a.tresponse.getTime())/1e3}),o[a]={average:d.reduce(function(a,b){return a+b})/d.length,high:d.reduce(function(a,b){return b>a?b:a}),low:d.reduce(function(a,b){return b>a?a:b}),count:d.length},f=c.map(function(a){return a.mediaduration}),p[a]={average:f.reduce(function(a,b){return a+b})/d.length/o[a].average,high:f.reduce(function(a,b){return b>a?b:a})/o[a].low,low:f.reduce(function(a,b){return b>a?a:b})/o[a].high,count:f.length})};if(k&&l){b=l.getCurrentRepresentationSwitch(k),c=l.getCurrentBufferLevel(k),d=l.getHttpRequests(k),e=l.getCurrentDroppedFrames(k),j=l.getRequestsQueue(k),r("video",d),r("audio",d);var s=this.streamInfo.index;return null!==b&&(f=l.getIndexForRepresentation(b.to,s),g=l.getBandwidthForRepresentation(b.to,s),g/=1e3,g=Math.round(g)),i=l.getMaxIndexForBufferType(a,s),null!==c&&(m=c.level.toPrecision(5)),null!==e&&(q=e.droppedFrames),(isNaN(g)||void 0===g)&&(g=0),(isNaN(f)||void 0===f)&&(f=0),(isNaN(i)||void 0===i)&&(i=0),(isNaN(m)||void 0===m)&&(m=0),h=this.mediaPlayer_.getQualityFor(a),{bandwidth:g,bitrateIndex:f,pendingIndex:h!==f?"(-> "+h+")":"",numBitrates:i,bufferLength:m,droppedFrames:q,movingLatency:n,movingDownload:o,movingRatio:p,requestsQueue:j}}return null},c.prototype.onMetricChanged=function(a){var b;"video"===a.data.stream&&(b=this.getCribbedMetricsFor("video"),b&&b.bitrateIndex!==this.tech_.featuresBitrateIndex&&(this.tech_.featuresBitrateIndex=b.bitrateIndex,this.tech_.featuresBitrate=b,this.tech_.trigger(b.bitrateIndex>this.tech_.featuresBitrateIndex?"bandwidthIncrease":"bandwidthDecrease")))},c.prototype.onStreamSwitchComplete=function(a){this.tech_.featuresBitrateIndex=a.data.toStreamInfo.index,this.streamInfo=a.data.toStreamInfo;var c=b.fixEvent({type:"bitratechange",data:a.data});this.tech_.trigger(c)},c.prototype.initializeDashJS=function(a,d){var e={};return d?(c.showErrors(this.elParent_),this.tech_.triggerReady(),void this.dispose()):(c.getWidevineProtectionData&&(e=c.getWidevineProtectionData(a),this.keySystemOptions_=f(this.keySystemOptions_,e)),void this.resetSrc_(b.bind(this,function(){c.showErrors(this.elParent_),this.mediaPlayer_.attachSource(a,null,this.keySystemOptions_),this.tech_.triggerReady()})))},c.hideErrors=function(a){a.className+="vjs-dashjs-hide-errors"},c.showErrors=function(a){setTimeout(function(){a.className=a.className.replace("vjs-dashjs-hide-errors","")},250)},c.buildDashJSProtData=function(a){var b,c,e,g={};if(!a||!d(a))return g;for(e=0;e<a.length;e++)b=a[e],c=f({},b.options),c.licenseUrl&&(c.laURL=c.licenseUrl,delete c.licenseUrl),g[b.name]=c;return g},c.prototype.resetSrc_=function(a){this.el_&&(this.el_.src="",this.el_.setMediaKeys?this.el_.setMediaKeys(null).then(a,a):a())},c.prototype.dispose=function(){this.mediaPlayer_&&this.mediaPlayer_.reset(),this.resetSrc_(function(){})},a.MediaSource&&b.Html5.registerSourceHandler({canHandleSource:function(a){var b=/^application\/dash\+xml/i,c=/\.mpd/i;return b.test(a.type)?"probably":c.test(a.src)?"maybe":""},handleSource:function(a,b){return new c(a,b)}},0),b.Html5DashJS=c}(window,window.videojs);